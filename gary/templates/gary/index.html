{% extends 'base.html' %} {% load static %} 
{% block styles%}
<link href="{% static 'jquery-ui-1.12.1/jquery-ui.min.css' %}" rel="stylesheet">
<style>
    table {
        table-layout: fixed;
        word-break: break-all;
        word-wrap: break-word;
        border: 3px black solid;
    }

    th {
        border: 2px white solid;
        word-wrap: break-word;
    }

    td {
        border: 2px white solid;
        word-wrap: break-word;

    }

    img {
        width: 100%;
    }
    .fix-div{
        margin: 0 auto;
        position: fixed;
        width: 1137px;
        left: 0; 
        right: 0;
        z-index: 100;
    }
    .toggle {
        height: 50px;
        line-height: 50px;
        border-top: 2px solid #CC9;
        background: #3FF;
    }
    /* .active{
        opacity: .4;
    } */
</style>
{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12" style="padding: 0">
            <form method="POST" id = "fix1" class="">
                {% csrf_token %}
                <table class="table" style="background-color: #f9ebc0;color:black;text-align: center">
                    <thead style="background-color: #1eb4ab;color:white;">
                        <tr>
                            <th>食譜</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                            <th>Saturday</th>
                            <th>Sunday</th>
                        </tr>
                    </thead>
                    <tbody id="monday" name="monday">
                            <tr>
                                <th colspan="1">熱量</th>
                                <td><small>熱量:0大卡</small></td>
                                <td><small>熱量:0大卡</small></td>
                                <td><small>熱量:0大卡</small></td>
                                <td><small>熱量:0大卡</small></td>
                                <td><small>熱量:0大卡</small></td>
                                <td><small>熱量:0大卡</small></td>
                                <td><small>熱量:0大卡</small></td>
                            </tr>
                        </tbody>
                    <tbody id="monday" name="monday">
                        <tr>
                            <th colspan="1">BREAKFAST</th>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="1-1">
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="2-1">
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="3-1">
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="4-1">
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="5-1">
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="6-1">
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="7-1">
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="monday" name="monday">
                            <tr>
                                <th colspan="1">LUNCH</th>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="1-2">
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="2-2">
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="3-2">
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="4-2">
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="5-2">
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="6-2">
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="7-2">
                                </td>
                            </tr>
                        </tbody>
                        <tbody id="monday" name="monday">
                                <tr>
                                    <th colspan="1">DINNER</th>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="1-3">
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="2-3">
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="3-3">
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="4-3">
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="5-3">
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="6-3">
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="7-3">
                                    </td>
                                </tr>
                            </tbody>
    
                    <tbody>
                        <tr>
                            <th colspan="8">標題 &nbsp;:&nbsp;&nbsp;<input type="text" class="btn btu-primary" name="title" ></th>
                        </tr>
                        <tr>
                            <th colspan="8"><input id="btn1" type="submit" class="btn btu-primary" value="儲存"></th>
                        </tr>
                    </tbody>
                </table>
            </form>   
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-md-6">
            <div class="row">
            {% for recipe in recipes %}
                <div class="card draggable col-md-6" style="border: 3px solid black;">
                    <a href="{% url 'recipe:showrecipe' recipe.recid %}">
                    <img class="card-img-top" src="/media/{{recipe.reccover}}" alt="Card image cap" data-toggle="modal" data-target="#exampleModal">
                    </a>
                    <div class="card-body">
                        <h4 class="card-title" style="font-weight: 900">[食譜]{{recipe.recname}}</h4>
                        <p class="card-text">{{recipe.recdesc}}</p>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">葷素: {{recipe.recvegan}}</li>
                        <li class="list-group-item">熱量: {{recipe.reccal}}</li>
                    </ul>
                </div>
            {% endfor %}
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="row">
            {% for storemenu in storemenu %}
                <div class="card draggable col-md-6" style="border: 3px solid black;">
                    <img class="card-img-top" id="imgall" src="/media/{{storemenu.cimg}}" alt="Card image cap" data-toggle="modal" data-target="#exampleModal">
                    <div class="card-body">
                        <h4 class="card-title" style="font-weight: 900">[店家]{{storemenu.cname}}</h4>
                        <p class="card-text">{{storemenu.cintroduction}}</p>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">類型: {{storemenu.ctype}}</li>
                        <li class="list-group-item">熱量: {{storemenu.ccal}}</li>
                        <li class="list-group-item">價錢: {{storemenu.cprice}}</li>
                    </ul>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
<script src="{% static 'jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script>
    var a = 100;
    $(".draggable").draggable({
        // brings the item back to its place when dragging is over
        revert:true, 
        
        // let the dragged item always on the top
        // stack: ".draggable"

        start: function(event, ui) { $(this).css("z-index", a=105); },
        stop : function(event, ui) { $(this).css("z-index", a=95); },
        
        
    });   
    
    $(".dropzone").droppable({
        drop: function(event, ui) {
            
            var basket = $(this);
            var move = ui.draggable;
            
            addBasket(basket,move)
        }   
    });


    function addBasket(basket, move) {
        //餐點名字 move.find(".card-title").html()
        //餐點照片 move.find("img").attr("src")
        title = move.find(".card-title").text()
        image_src = move.find("img").attr("src")
        // basket.html(move.find(".card-title").html() + 
        // "<img src='"  + move.find("img").attr("src") + "'>" );
        basket.find('input').attr('value',title)
        basket.find('img').attr('src',image_src)
    }  

    $.fn.fixedDiv = function(actCls, i){
            var that = $(this),
                h = that.height(),
                topVal = (h + 2) * i,
                offsetTop = that.offset().top,
                scrollTop;
            function fix(){
                scrollTop = $(document).scrollTop();   
                // console.log("offsetTop: " + offsetTop);
                // console.log("scroll: " + screenTop);
                if (scrollTop > (offsetTop - topVal)) {
                    that.addClass(actCls);
                    that.css("top", topVal + "px");                
                } else {
                    that.removeClass(actCls);
                }
            }
            fix();
            $(window).scroll(fix);
        }
        $('#fix1').fixedDiv('fix-div', 0);
        $('#fix2').fixedDiv('fix-div', 1);
        $('#fix3').fixedDiv('fix-div', 2);
        $('#fix4').fixedDiv('fix-div', 3);
        $('#fix5').fixedDiv('fix-div', 4);
</script>
{% endblock %}