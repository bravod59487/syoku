{% extends 'base.html' %} {% load static %} 
{% block styles%}
<link href="{% static 'jquery-ui-1.12.1/jquery-ui.min.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<style>
    table {
        table-layout: fixed;
        word-break: break-all;
        word-wrap: break-word;
        border: 3px black solid;
    }

    th {
        border: 2px white solid;
        word-wrap: break-word;
    }

    td {
        border: 2px white solid;
        word-wrap: break-word;

    }

    img {
        width: 100%;
    }
    .fix-div{
        margin: 0 auto;
        position: fixed;
        width: 1137px;
        left: 0; 
        right: 0;
        z-index: 100;
        top:0;
        opacity: 0.9;
    }
    .toggle {
        height: 50px;
        line-height: 50px;
        border-top: 2px solid #CC9;
        background: #3FF;
    }
    /* .active{
        opacity: .4;
    } */
    td img {
        max-height: 92px
    }
</style>
{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12" style="padding: 0">
            <form method="POST" id = "fix1" class="">
                {% csrf_token %}
                <table class="table" style="background-color: #f9ebc0;color:black;text-align: center">
                    <thead style="background-color: #1eb4ab;color:white;">
                        <tr>
                            <th>食譜</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                            <th>Saturday</th>
                            <th>Sunday</th>
                        </tr>
                    </thead>
                    <tbody id="cccccal" name="cccccal">
                            <tr>
                                <th colspan="1">熱量</th>
                                <td><small>熱量: <small id="ccal1" ></small>大卡</small></td>
                                <td><small>熱量: <small id="ccal2" ></small>大卡</small></td>
                                <td><small>熱量: <small id="ccal3" ></small>大卡</small></td>
                                <td><small>熱量: <small id="ccal4" ></small>大卡</small></td>
                                <td><small>熱量: <small id="ccal5" ></small>大卡</small></td>
                                <td><small>熱量: <small id="ccal6" ></small>大卡</small></td>
                                <td><small>熱量: <small id="ccal7" ></small>大卡</small></td>
                            </tr>
                        </tbody>
                    <tbody id="BREAKFAST" name="BREAKFAST">
                        <tr>
                            <th colspan="1">BREAKFAST</th>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="1-1">
                                <h5 name='1-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="2-1">
                                <h5 name='2-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="3-1">
                                <h5 name='3-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="4-1">
                                <h5 name='4-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="5-1">
                                <h5 name='5-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="6-1">
                                <h5 name='6-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                            <td style="padding: 0" class="dropzone">
                                <img src="{% static 'images/empty.png' %}">
                                <input type="hidden" value="" name="7-1">
                                <h5 name='7-1cals' style="display: none" >熱量: 0</h5>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="LUNCH" name="LUNCH">
                            <tr>
                                <th colspan="1">LUNCH</th>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="1-2">
                                    <h5 name='1-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="2-2">
                                    <h5 name='2-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="3-2">
                                    <h5 name='3-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="4-2">
                                    <h5 name='4-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="5-2">
                                    <h5 name='5-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="6-2">
                                    <h5 name='6-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                                <td style="padding: 0" class="dropzone">
                                    <img src="{% static 'images/empty.png' %}">
                                    <input type="hidden" value="" name="7-2">
                                    <h5 name='7-2cals' style="display: none" >熱量: 0</h5>
                                </td>
                            </tr>
                        </tbody>
                        <tbody id="DINNER" name="DINNER">
                                <tr>
                                    <th colspan="1">DINNER</th>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="1-3">
                                        <h5 name='1-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="2-3">
                                        <h5 name='2-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="3-3">
                                        <h5 name='3-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="4-3">
                                        <h5 name='4-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="5-3">
                                        <h5 name='5-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="6-3">
                                        <h5 name='6-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                    <td style="padding: 0" class="dropzone">
                                        <img src="{% static 'images/empty.png' %}">
                                        <input type="hidden" value="" name="7-3">
                                        <h5 name='7-3cals' style="display: none" >熱量: 0</h5>
                                    </td>
                                </tr>
                            </tbody>
    
                    <tbody>
                        <tr>
                            <th colspan="8">
                                標題 &nbsp;:&nbsp;&nbsp;
                                <input type="text" class="btn btu-primary" name="title" >&nbsp;
                                <input id="btn1" type="submit" class="btn btu-primary" value="儲存">
                                <a class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" style="color:white" id="random_plan" >隨機</a>
                            </th>
                        </tr>
                        
                    </tbody>
                </table>
            </form>   
        </div>
    </div>
    <div class="row">
        <div class="col-12 col-md-6">
            <div class="row">
            {% for recipe in recipes %}
                <div class="card col-md-6" style="border: 3px solid black;">
                    <div class="draggable">
                        <a href="{% url 'recipe:showrecipe' recipe.recid %}">
                        <img class="card-img-top" src="/media/{{recipe.reccover}}" alt="Card image cap" data-toggle="modal" data-target="#exampleModal">
                        </a>
                        <div style="display: none">
                            <div class="card-body">
                                <h4 class="card-title" style="font-weight: 900">[食譜]{{recipe.recname}}</h4>
                                <!-- <p class="card-text">{{recipe.recdesc}}</p> -->
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">葷素: {{recipe.recvegan}}</li>
                                <li name="foodcal" class="list-group-item">熱量: {{recipe.reccal}}</li>
                            </ul>
                        </div>                        
                    </div>
                    <div class="card-body">
                        <h4 class="card-title" style="font-weight: 900">[食譜]{{recipe.recname}}</h4>
                        <!-- <p class="card-text">{{recipe.recdesc}}</p> -->
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">葷素: {{recipe.recvegan}}</li>
                        <li name="foodcal" class="list-group-item">熱量: {{recipe.reccal}}</li>
                    </ul>
                </div>
            {% endfor %}
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="row">
            {% for storemenu in storemenu %}
                <div class="card col-md-6" style="border: 3px solid black;">
                    <div class="draggable">
                            <a href="{% url 'storemenu:cindex' storemenu.Company_email %}"><img class="card-img-top"  id="imgall" src="/media/{{storemenu.cimg}}" alt="Card image cap" data-toggle="modal" data-target="#exampleModal"></a>


                         <div style="display: none"> <!--這一句話 把底下的都藏起來了 -->
                            <div class="card-body">
                                <h4 class="card-title" style="font-weight: 900">[店家]{{storemenu.cname}}</h4>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">類型: {{storemenu.ctype}}</li>
                                <li name="foodcal" class="list-group-item">熱量: {{storemenu.ccal}}</li>
                                <li class="list-group-item">價錢: {{storemenu.cprice}}</li>
                            </ul>
                        </div>



                    </div>
                    <div class="card-body">
                        <h4 class="card-title" style="font-weight: 900">[店家]{{storemenu.cname}}</h4>
                        <!-- <p class="card-text">{{storemenu.cintroduction}}</p> -->
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">類型: {{storemenu.ctype}}</li>
                        <li name="foodcal" class="list-group-item">熱量: {{storemenu.ccal}}</li>
                        <li class="list-group-item">價錢: {{storemenu.cprice}}</li>
                    </ul>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>

    <!-- 彈跳出一個圖片images/1.gif'  如果 再點一下 會進入function random_plan() -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" onclick="random_plan()">
        <div class="modal-dialog modal-dialog-centered" role="document" >
                <img src="{% static 'images/1.gif' %}"  alt="" >
                <!-- <button id="close" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                <!-- <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div> -->
            </div>
        </div>
    </div>
    <!-- cursor:pointer 是把 滑鼠游標變成超連結的樣式 -->
    <h1 id="table" style="color:white; font-size: 80px; position: fixed;right: 50px;bottom: 50px; cursor:pointer;" ><i class="fas fa-plus-circle"></i></h1>
    <!-- <h1 style="color:white; font-size: 80px; position: fixed;right: 50px;bottom: 50px; cursor:pointer display: none;" ><i class="fas fa-minus-circle"></i></i></h1> -->
    

</div>

{% endblock %}
{% block scripts %}
<script src="{% static 'jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script>
    // var a = 100;
    // .draggable為底下每一個圖片 .draggable 設定成可以拖曳的
    $(".draggable").draggable({

        // $(this).css('cursor','move');
        // brings the item back to its place when dragging is over
        // 當拖動結束時將項目帶回原位
        revert:true, 
        
        // let the dragged item always on the top
        // stack: ".draggable",
        
        // z-index越大 代表在越上層
        // 開始的z-index比結束z-index還要大 所以每次拖曳都會在上面那一層
        start: function(event, ui) { $(this).css("z-index", a=105); },
        stop : function(event, ui) { $(this).css("z-index", a=95); },
        
        
    });  


    // .dropzone 每個空的格子.droppable 就可被當成一個可以放置的位置
    $(".dropzone").droppable({
        // 不知道even 跟UI 的意思是 (猜測UI就是被拖曳的目標)
        drop: function(event, ui) {
            
            // this這裡指的是被放置的格子
            var basket = $(this);
            // 把UI變成可以拖曳的(猜的)
            //move為被拖曳的物件
            var move = ui.draggable;
            
            
            addBasket(basket,move)
            cal_count();
        }   
    });


    // #自動收起來 上面的表單
    $('#table').click(function(){
        $("#fix1").toggle( "fold", 2000 );
    });

    // 把拖曳的物件放置在上面 改上面的參數讓上面可以顯示出來
    function addBasket(basket, move) {
        //餐點名字 move.find(".card-title").html()
        //餐點照片 move.find("img").attr("src")
        title = move.find(".card-title").text()
        image_src = move.find("img").attr("src")
        cal_text = move.find("li[name='foodcal' ]").text()
        // alert(cal_text)
        // basket.html(move.find(".card-title").html() + 
        // "<img src='"  + move.find("img").attr("src") + "'>" );
        basket.find('input').attr('value',title)
        basket.find('img').attr('src',image_src)
        basket.find('h5').text(cal_text)

    }  
    // fixedDiv這個在下面('#fix1').fixedDiv 指的是 fix1 為上面整個table  fixedDiv是指這個function
    $.fn.fixedDiv = function(actCls, i){
        var that = $(this);
        var h = that.height();
        console.log(h) //450 那個物件的高度
        var topVal = (h + 2) * i; //這個算法是 如果第一個 就是0 最頂端 第二個就是在第一個的位子下面
        console.log($(this).offset()) //{top: 360, left: 50}
        var offsetTop = $(this).offset().top

        function fix(){
            scrollTop = $(document).scrollTop();   //為滾動的畫面最頂端位置
            console.log("offsetTop: " + offsetTop);
            console.log("scroll: " + screenTop);
            console.log(scrollTop) //為滾動的畫面最頂端位置
            if (scrollTop > (offsetTop - topVal)) {
                that.addClass(actCls);
                that.css("top", topVal + "px");                
            } else {
                that.removeClass(actCls);
            }
        }
        fix();
        $(window).scroll(fix);
    }

    // $('#mainNav').fixedDiv('fix-div', 0);
    // $('#fix1').fixedDiv('fix-div', 1);
    $('#fix1').fixedDiv('fix-div', 0);
    // $('#fix2').fixedDiv('fix-div', 1);
    // $('#fix3').fixedDiv('fix-div', 2);
    // $('#fix4').fixedDiv('fix-div', 3);
    // $('#fix5').fixedDiv('fix-div', 4);
    
    // $('#random_plan').click(random_plan)

    // $('#random_plan').click(function(){
    //     setTimeout(random_plan,2000)
    //     setTimeout($('#exampleModalCenter').modal('hide'),1000)
        
    // });


    // 自動變化菜單的function
    function random_plan(){
        // $('#exampleModalCenter').removeClass('show');
        // $('#exampleModalCenter').css('display','none');
        // $('body').removeClass('modal-open');
        

        var items = $('.draggable')
        var len = items.length
        // alert(len) 58個


        // eq(index)
        // alert(num)
        
        // jquery的each就是裡面都執行一次
        $('td.dropzone').each(function(){
            // Math.floor() 函式會回傳無條進捨去後的最大整數。
            // Math.random*10 就是 0~9之間的數字
            // (Math.random*10)+1 就是 1~10之間的數字
            // 底下是 亂數是(0~長度)+1 可以為小樹 所以要無條件捨去再去最大整數 -1
            // 0~58 →1~59 捨去-1 →0~58

            var num = Math.floor((Math.random() * len) + 1) -1;

            //找出標題 圖片 卡洛里
            title = items.eq(num).find(".card-title").text()
            image_src = items.eq(num).find("img").attr("src")
            cal_text = items.eq(num).find("li[name='foodcal' ]").text()

            //塞回最上面的個人菜單
            $(this).find('img').attr('src',image_src);
            $(this).find('input').attr('value',title);
            $(this).find('h5').text(cal_text);
            cal_count();
        });
    }

    function cal_count(){
        cb_1 = Number($("tbody#BREAKFAST h5[name='1-1cals']").text().split(" ")[1]) 
        cl_1 = Number($("tbody#LUNCH h5[name='1-2cals']").text().split(" ")[1])  
        cd_1 = Number($("tbody#DINNER h5[name='1-3cals']").text().split(" ")[1])
        cal1 = (cb_1+cl_1+cd_1)
        cb_2 = Number($("tbody#BREAKFAST h5[name='2-1cals']").text().split(" ")[1]) 
        cl_2 = Number($("tbody#LUNCH h5[name='2-2cals']").text().split(" ")[1])  
        cd_2 = Number($("tbody#DINNER h5[name='2-3cals']").text().split(" ")[1])
        cal2 = (cb_2+cl_2+cd_2)
        cb_3 = Number($("tbody#BREAKFAST h5[name='3-1cals']").text().split(" ")[1]) 
        cl_3 = Number($("tbody#LUNCH h5[name='3-2cals']").text().split(" ")[1])  
        cd_3 = Number($("tbody#DINNER h5[name='3-3cals']").text().split(" ")[1])
        cal3 = (cb_3+cl_3+cd_3)
        cb_4 = Number($("tbody#BREAKFAST h5[name='4-1cals']").text().split(" ")[1]) 
        cl_4 = Number($("tbody#LUNCH h5[name='4-2cals']").text().split(" ")[1])  
        cd_4 = Number($("tbody#DINNER h5[name='4-3cals']").text().split(" ")[1])
        cal4 = (cb_4+cl_4+cd_4)
        cb_5 = Number($("tbody#BREAKFAST h5[name='5-1cals']").text().split(" ")[1]) 
        cl_5 = Number($("tbody#LUNCH h5[name='5-2cals']").text().split(" ")[1])  
        cd_5 = Number($("tbody#DINNER h5[name='5-3cals']").text().split(" ")[1])
        cal5 = (cb_5+cl_5+cd_5)
        cb_6 = Number($("tbody#BREAKFAST h5[name='6-1cals']").text().split(" ")[1]) 
        cl_6 = Number($("tbody#LUNCH h5[name='6-2cals']").text().split(" ")[1])  
        cd_6 = Number($("tbody#DINNER h5[name='6-3cals']").text().split(" ")[1])
        cal6 = (cb_6+cl_6+cd_6)
        cb_7 = Number($("tbody#BREAKFAST h5[name='7-1cals']").text().split(" ")[1]) 
        cl_7 = Number($("tbody#LUNCH h5[name='7-2cals']").text().split(" ")[1])  
        cd_7 = Number($("tbody#DINNER h5[name='7-3cals']").text().split(" ")[1])
        cal7 = (cb_7+cl_7+cd_7)
        // alert(mon_b)
        $("#ccal1").text(cal1)
        $("#ccal2").text(cal2)
        $("#ccal3").text(cal3)
        $("#ccal4").text(cal4)
        $("#ccal5").text(cal5)
        $("#ccal6").text(cal6)
        $("#ccal7").text(cal7)
    }
</script>
{% endblock %}